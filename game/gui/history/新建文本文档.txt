
screen history():

    tag menu

    ## Avoid predicting this screen, as it can be very large.
    predict False

    use game_menu(_(History), scroll=(vpgrid if gui.history_height else viewport), yinitial=1.0)

        style_prefix history

        for h in _history_list

            window

                ## This lays things out properly if history_height is None.
                has fixed
                    yfit True

                if h.who

                    label h.who
                        style history_name

                        ## Take the color of the who text from the Character, if
                        ## set.
                        if color in h.who_args
                            text_color h.who_args[color]

                $ what = renpy.filter_text_tags(h.what, allow=gui.history_allow_tags)
                text what

        if not _history_list
            label _(The dialogue history is empty.)
